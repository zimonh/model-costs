<!DOCTYPE html>
<html>
    <head>
        <title>Model Costs calculator</title>
        <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ’¸</text></svg>">
        <link href="preflight.min.css" rel="stylesheet">
        <link href="utilities.min.css" rel="stylesheet">
    </head>
    <body>
        <div class="inline-block w-full grid text-center">
            <div style="max-width: 40rem; " class="w-full place-self-center p-12 inline-block">
                <div class="text-left">
                    <h1 class="mb-8">Calculator for <br>ChatGPT API costs ðŸ’¸</h1>
                    <p class="text-xs">Disclaimer: This is a JavaScript calculator that utilizes the OpenAI tokenizer. The costs displayed are based on the information provided on the OpenAI website. However, it is important to note that while I strive to provide accurate results, I can not guarantee them.</p>
                    <label for="input-textarea" class="block pt-6 text-gray-700 text-sm font-bold mb-2" for="menu-container" >model:</label>
                    <div id="menu-container"></div>
                    
                    <label for="input-textarea" class="block pt-6 text-gray-700 text-sm font-bold mb-2" >input:</label>
                    <textarea placeholder="The input text you want checked" class=" rounded p-3 w-full" id="input-textarea" rows="3" ></textarea>
                    <div id="output-container-input" class="mt-3 p-2 pl-4 shadow" style="background-color: #dfdfdf; color:#404040;"></div>
                    
                    <label for="output-textarea" class="block pt-6 text-gray-700 text-sm font-bold mb-2" >output:</label>
                    <textarea placeholder="The expected output text" class=" rounded p-3 w-full" id="output-textarea" rows="3" ></textarea>
                    <div id="output-container-output" class="mt-3 p-2 pl-4 shadow" style="background-color: #dfdfdf; color:#404040;"></div>
                    
                    <label for="training-textarea" class="block pt-6 text-gray-700 text-sm font-bold mb-2" >training:</label>
                    <textarea placeholder="Training text" class=" rounded p-3 w-full" id="training-textarea" rows="3" ></textarea>
                    <div id="output-container-training" class="mt-3 p-2 pl-4 shadow" style="background-color: #dfdfdf; color:#404040;"></div>
                    
                    <button  class="mt-6 bg-black hover:bg-white hover:text-black text-white font-bold py-2 px-4 rounded" onclick="calculateTotalPrice()">Calculate Price</button>
                    <div id="output-container-total" class="mt-6 text-4xl"></div>
                </div>
            </div>
        </div>

        <script src="browser.min.js"></script>
        <script>
    const { encode, decode } = gpt3encoder;

    const dropdown = document.createElement("select");

    dropdown.classList.add('bg-gray-50','border','border-gray-300','text-gray-900','text-sm','rounded-lg','focus:ring-blue-500','focus:border-blue-500','block','w-full','p-5','dark:bg-gray-700','dark:border-gray-600','dark:placeholder-gray-400','dark:text-white','dark:focus:ring-blue-500','dark:focus:border-blue-500')

    function calculateTotalPrice(){
        let total = 0;
        total += calculatePrice('input');
        total += calculatePrice('output');
        total += calculatePrice('training');


      const outputContainer = document.getElementById(`output-container-total`);
      outputContainer.innerHTML = `Total Price: $${total.toFixed(7).replace(/\.?0+$/, "")}`;
    }

    function calculatePrice(type) {
      const selectedOption = dropdown.options[dropdown.selectedIndex];
      const pricePerInputToken = selectedOption.getAttribute(`data-price-per-${type}-token`);
      const input = document.getElementById(`${type}-textarea`);
      const encodedInput = encode(input.value);
      const inputTokenCount = encodedInput.length;
      // Price per 1K tokens (adjust as needed)
      const price = (pricePerInputToken * inputTokenCount) / 1000;

      const outputContainer = document.getElementById(`output-container-${type}`);
      const displayPrice = price === 0 ? 'N/A' : price.toFixed(7).replace(/\.?0+$/, "");
      const displayPricePerInputToken = pricePerInputToken === '0' ? 'N/A' : (pricePerInputToken/1000).toFixed(7).replace(/\.?0+$/, "");
      outputContainer.innerHTML = `<div>
      <div class="flex items-center pt-2 text-base text-gray-900 rounded-lg bg-gray-50 group ">
        ${type} token count:
        <span class="flex-1 ml-3 whitespace-nowrap font-bold ">${ price === 0 ? 'N/A' : inputTokenCount }</span>
      </div>
      <div class="flex items-center pt-2 text-base text-gray-900 rounded-lg bg-gray-50 group ">
        $ per token:
        <span class="flex-1 ml-3 whitespace-nowrap font-bold ">${displayPricePerInputToken}</span>
      </div>
      <div class="flex items-center pt-2 text-base text-gray-900 rounded-lg bg-gray-50 group ">
        $ total:
        <span class="flex-1 ml-3 whitespace-nowrap font-bold ">${displayPrice}</span>
      </div>


      <div>`;
      return price;
    }

    // Paste the JavaScript function here
    function generateMenuFromJSON(jsonData) {
      const models = jsonData.models;

      models.forEach((model) => {
        const modelName = model.name;
        const contexts = model.contexts;

        for (const context in contexts) {
          const optionText = `${modelName} ${context}`;
          const option = document.createElement("option");
          option.text = optionText;
          option.dataset.pricePerOutputToken = contexts[context].output;
          option.dataset.pricePerInputToken = contexts[context].input === undefined ? contexts[context].output : contexts[context].input;
          option.dataset.pricePerTrainingToken = contexts[context].training === undefined ? 0 : contexts[context].training;
          dropdown.appendChild(option);
        }
      });
      // dropdown.placeHolder = "select a model";
      dropdown.onchange = () =>{
        calculateTotalPrice();

      }
      // const inputTextarea  = document.getElementById(`input-textarea`);
    document.getElementById(`input-textarea`).oninput = () => {
        calculateTotalPrice();
    };
    document.getElementById(`output-textarea`).oninput = () => {
        calculateTotalPrice();
    };
    document.getElementById(`training-textarea`).oninput = () => {
        calculateTotalPrice();
    };

      const container = document.getElementById("menu-container");
      container.appendChild(dropdown);
    }


const jsonData = {
    "models":
    [
        {
            "name": "GPT-4",
            "description": "With broad general knowledge and domain expertise, GPT-4 can follow complex instructions in natural language and solve difficult problems with accuracy.",
            "contexts":
            {
                "8K":
                {
                    "input": 0.03,
                    "output": 0.06
                },
                "32K":
                {
                    "input": 0.06,
                    "output": 0.12
                }
            }
        },
        {
            "name": "ChatGPT",
            "description": "ChatGPT models are optimized for dialogue. The performance of gpt-3.5-turbo is on par with Instruct Davinci.",
            "contexts":
            {
                "4K":
                {
                    "input": 0.0015,
                    "output": 0.002
                },
                "16K":
                {
                    "input": 0.003,
                    "output": 0.004
                }
            }
        },
        {
            "name": "Fine-tune Ada",
            "description": "Capable of very simple tasks, usually the fastest model in the GPT-3 series, and lowest cost.",
            "contexts":
            {
                "2K":
                {
                    "training": 0.0004,
                    "output": 0.0016
                }
            }
        },
        {
            "name": "Fine-tune Babbage",
            "description": "Capable of straightforward tasks, very fast, and lower cost.",
            "contexts":
            {
                "2K":
                {
                    "training": 0.0006,
                    "output": 0.0024
                }
            }
        },
        {
            "name": "Fine-tune Curie",
            "description": "Very capable, but faster and lower cost than Davinci.",
            "contexts":
            {
                "2K":
                {
                    "training": 0.003,
                    "output": 0.012
                }
            }
        },
        {
            "name": "Fine-tune Davinci",
            "description": "Most capable GPT-3 model. Can do any task the other models can do, often with higher quality.",
            "contexts":
            {
                "2K":
                {
                    "training": 0.03,
                    "output": 0.12
                }
            }
        }
    ]
};
document.addEventListener("DOMContentLoaded", function() {
    generateMenuFromJSON(jsonData);
});
  </script>
    </body>
</html>